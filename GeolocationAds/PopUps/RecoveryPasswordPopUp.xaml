<?xml version="1.0" encoding="utf-8" ?>
<mct:Popup
    x:Class="GeolocationAds.PopUps.RecoveryPasswordPopUp"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:drawable="clr-namespace:GeolocationAds.CustomCotrols"
    xmlns:local="clr-namespace:GeolocationAds.CustomContentView"
    xmlns:mct="clr-namespace:CommunityToolkit.Maui.Views;assembly=CommunityToolkit.Maui"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:views="clr-namespace:GeolocationAds.ViewTemplates"
    Color="Transparent">

    <Border
        Margin="10"
        HeightRequest="380"
        Style="{StaticResource popUpBorder}"
        WidthRequest="360">

        <Grid
            Padding="10"
            BackgroundColor="White"
            RowDefinitions="Auto,Auto,Auto,Auto">

            <!--<HorizontalStackLayout Grid.Row="0">

                <Label
                    HorizontalOptions="Start"
                    HorizontalTextAlignment="Start"
                    Style="{StaticResource globalLabel}"
                    Text="Recovery Password" />

                <Button
                    Margin="5"
                    BackgroundColor="Transparent"
                    Clicked="OnCloseButtonClicked"
                    Style="{StaticResource XButton}">

                    <Button.ImageSource>
                        <FontImageSource
                            FontFamily="MaterialIconsOutlined-Regular"
                            Glyph="&#xe5cd;"
                            Color="#3e4144" />
                    </Button.ImageSource>
                </Button>
            </HorizontalStackLayout>-->

            <!--  ðŸŽ¨ SemiCircle Header  -->
            <Grid Grid.Row="0" Grid.ColumnSpan="2">
                <GraphicsView BackgroundColor="Transparent">
                    <GraphicsView.Drawable>
                        <drawable:SemiCircle />
                    </GraphicsView.Drawable>
                </GraphicsView>

                <Label
                    Grid.Column="0"
                    FontAttributes="Bold"
                    FontSize="24"
                    HorizontalOptions="Center"
                    HorizontalTextAlignment="Start"
                    Text="Recovery Password"
                    TextColor="White"
                    VerticalOptions="Center"
                    VerticalTextAlignment="Center" />

                <Button
                    Grid.Column="1"
                    Clicked="OnCloseButtonClicked"
                    Style="{StaticResource XButton}">
                    <Button.ImageSource>
                        <FontImageSource
                            FontFamily="MaterialIconsOutlined-Regular"
                            Glyph="&#xe5cd;"
                            Color="White" />
                    </Button.ImageSource>
                </Button>
            </Grid>

            <CollectionView Grid.Row="1" ItemsSource="{Binding ValidationResults}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <StackLayout>
                            <Label Style="{StaticResource ErrorLabelStyle}" Text="{Binding ErrorMessage}" />
                        </StackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <VerticalStackLayout Grid.Row="2" IsVisible="{Binding StepIndex, Converter={StaticResource StepViewConverter}, ConverterParameter=1}">

                <Label Style="{StaticResource globalLabel}" Text="Type Email:" />

                <local:CustomEntryContentView
                    IconSource="&#xe158;"
                    IsEnabled="{Binding IsLoading, Converter={StaticResource IsEnableConverter}}"
                    Placeholder="Enter your email"
                    Text="{Binding Email}" />
                <Button
                    Command="{Binding RecoveryPasswordCommand}"
                    IsVisible="{Binding IsLoading, Converter={StaticResource IsEnableConverter}}"
                    Style="{StaticResource globalButton}"
                    Text="Send Recovery Code" />
            </VerticalStackLayout>

            <VerticalStackLayout Grid.Row="2" IsVisible="{Binding StepIndex, Converter={StaticResource StepViewConverter}, ConverterParameter=2}">

                <Label Style="{StaticResource globalLabel}" Text="Confirm Code:" />

                <local:CustomEntryContentView
                    IconSource="&#xf042;"
                    IsEnabled="{Binding IsLoading, Converter={StaticResource IsEnableConverter}}"
                    Placeholder="Confirm Code"
                    Text="{Binding Code}" />
                <Button
                    Command="{Binding ConfirmCodeCommand}"
                    IsVisible="{Binding IsLoading, Converter={StaticResource IsEnableConverter}}"
                    Style="{StaticResource globalButton}"
                    Text="Confirm Code" />
            </VerticalStackLayout>

            <VerticalStackLayout Grid.Row="2" IsVisible="{Binding StepIndex, Converter={StaticResource StepViewConverter}, ConverterParameter=3}">

                <Label Style="{StaticResource globalLabel}" Text="New Password:" />

                <local:CustomEntryContentView
                    IconSource="&#xe897;"
                    IsEnabled="{Binding IsLoading, Converter={StaticResource IsEnableConverter}}"
                    Placeholder="New Password"
                    Text="{Binding Model.NewPassword}" />

                <local:CustomEntryContentView
                    IconSource="&#xe897;"
                    IsEnabled="{Binding IsLoading, Converter={StaticResource IsEnableConverter}}"
                    Placeholder="Confirm Password"
                    Text="{Binding Model.ConfirmNewPassword}" />

                <Button
                    Command="{Binding SubmitCommand}"
                    CommandParameter="{Binding Model}"
                    IsVisible="{Binding IsLoading, Converter={StaticResource IsEnableConverter}}"
                    Style="{StaticResource globalButton}"
                    Text="Complete" />
            </VerticalStackLayout>

            <HorizontalStackLayout Grid.Row="3" HorizontalOptions="Center">

                <Button
                    Command="{Binding GoBackCommand}"
                    IsVisible="{Binding IsLoading, Converter={StaticResource IsEnableConverter}}"
                    Style="{StaticResource globalButton}">

                    <Button.ImageSource>
                        <FontImageSource FontFamily="MaterialIconsOutlined-Regular" Glyph="&#xe5c4;" />
                    </Button.ImageSource>
                </Button>

                <Button
                    Command="{Binding GoForwardCommand}"
                    IsVisible="{Binding IsLoading, Converter={StaticResource IsEnableConverter}}"
                    Style="{StaticResource globalButton}">

                    <Button.ImageSource>
                        <FontImageSource FontFamily="MaterialIconsOutlined-Regular" Glyph="&#xe5c8;" />
                    </Button.ImageSource>
                </Button>
            </HorizontalStackLayout>

            <views:LoadingOverlay Grid.Row="0" IsVisible="{Binding IsLoading}" />
        </Grid>
    </Border>
</mct:Popup>